!function(t){var e=function(t){var e,n=Array.prototype.slice;return function(){var r=n.call(arguments),i=this;clearTimeout(e),e=setTimeout(function(){t.apply(i,r)},100)}},n=function(t){var e=t.match(/(\d+)/g);return new Date(e[0],e[1]-1,e[2])},r=function(){function r(e,n){this.$elem=e,this.$results=t(n.results),this.$entries=t(n.entries,this.$results),this.indexDataUrl=n.indexUrl,this.index=this.createIndex(),this.template=this.compileTemplate(t(n.template)),this.initialize()}return r.prototype.initialize=function(){var t=this;this.loadIndexData(function(e){t.populateIndex(e),t.populateSearchFromQuery(),t.bindKeypress()})},r.prototype.createIndex=function(){return lunr(function(){this.field("title",{boost:10}),this.field("categories"),this.ref("id"),this.field("author"),this.field("addressee"),this.field("position")})},r.prototype.compileTemplate=function(t){var e=t.text();return Mustache.parse(e),function(t,n){return Mustache.render(e,t,n)}},r.prototype.loadIndexData=function(e){t.getJSON(this.indexDataUrl,e)},r.prototype.populateIndex=function(e){var n=this.index;this.entries=t.map(e.entries,this.createEntry),t.each(this.entries,function(t,e){n.add(e)})},r.prototype.createEntry=function(e,r){var i=t.extend({id:r+1},e);return e.date&&t.extend(i,{date:n(e.date),pubdate:function(){return dateFormat(n(e.date),"yyyy-mm-dd")},displaydate:function(){return dateFormat(n(e.date),"mmm dd, yyyy")}}),i},r.prototype.bindKeypress=function(){var t=this,n=this.$elem.val();this.$elem.bind("keyup",e(function(){var e=t.$elem.val();e!==n&&t.search(e),n=e}))},r.prototype.search=function(e){var n=this.entries;if(e.length<2)this.$results.hide(),this.$entries.empty();else{var r=t.map(this.index.search(e),function(e){return t.grep(n,function(t){return t.id===parseInt(e.ref,10)})[0]});this.displayResults(r)}},r.prototype.displayResults=function(t){var e=this.$entries,n=this.$results;e.empty(),e.append(0===t.length?"<p>Nothing found.</p>":this.template({entries:t})),n.show()},r.prototype.populateSearchFromQuery=function(){var t=new URI(window.location.search.toString()),e=t.search(!0);e.hasOwnProperty("q")&&(this.$elem.val(e.q),this.search(e.q.toString()))},r}();t.fn.lunrSearch=function(e){return e=t.extend({},t.fn.lunrSearch.defaults,e),new r(this,e),this},t.fn.lunrSearch.defaults={indexUrl:"/search.json",results:"#search-results",entries:".entries",template:"#search-results-template"}}(jQuery);
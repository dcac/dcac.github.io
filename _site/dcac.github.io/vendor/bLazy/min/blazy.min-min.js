!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.Blazy=t()}(this,function(){function e(e){if(!document.querySelectorAll){var r=document.createStyleSheet();document.querySelectorAll=function(e,t,o,n,s){for(s=document.all,t=[],e=e.replace(/\[for\b/gi,"[htmlFor").split(","),o=e.length;o--;){for(r.addRule(e[o],"k:v"),n=s.length;n--;)s[n].currentStyle.k&&t.push(s[n]);r.removeRule(0)}return t}}v=!0,m=[],d={},f=e||{},f.error=f.error||!1,f.offset=f.offset||100,f.success=f.success||!1,f.selector=f.selector||".b-lazy",f.separator=f.separator||"|",f.container=f.container?document.querySelectorAll(f.container):!1,f.errorClass=f.errorClass||"b-error",f.breakpoints=f.breakpoints||!1,f.successClass=f.successClass||"b-loaded",f.src=u=f.src||"data-src",h=1<window.devicePixelRatio,d.top=0-f.offset,d.left=0-f.offset,w=l(o,25),g=l(s,50),s(),a(f.breakpoints,function(e){return e.width>=window.screen.width?(u=e.src,!1):void 0}),t()}function t(){n(f.selector),v&&(v=!1,f.container&&a(f.container,function(e){c(e,"scroll",w)}),c(window,"resize",g),c(window,"resize",w),c(window,"scroll",w)),o()}function o(){for(var t=0;p>t;t++){var o=m[t],r=o.getBoundingClientRect();(r.right>=d.left&&r.bottom>=d.top&&r.left<=d.right&&r.top<=d.bottom||-1!==(" "+o.className+" ").indexOf(" "+f.successClass+" "))&&(e.prototype.load(o),m.splice(t,1),p--,t--)}0===p&&e.prototype.destroy()}function r(e,t){if(t||0<e.offsetWidth&&0<e.offsetHeight){var o=e.getAttribute(u)||e.getAttribute(f.src);if(o){var o=o.split(f.separator),r=o[h&&1<o.length?1:0],o=new Image;a(f.breakpoints,function(t){e.removeAttribute(t.src)}),e.removeAttribute(f.src),o.onerror=function(){f.error&&f.error(e,"invalid"),e.className=e.className+" "+f.errorClass},o.onload=function(){"img"===e.nodeName.toLowerCase()?e.src=r:e.style.backgroundImage='url("'+r+'")',e.className=e.className+" "+f.successClass,f.success&&f.success(e)},o.src=r}else f.error&&f.error(e,"missing"),e.className=e.className+" "+f.errorClass}}function n(e){e=document.querySelectorAll(e);for(var t=p=e.length;t--;m.unshift(e[t]));}function s(){d.bottom=(window.innerHeight||document.documentElement.clientHeight)+f.offset,d.right=(window.innerWidth||document.documentElement.clientWidth)+f.offset}function c(e,t,o){e.attachEvent?e.attachEvent&&e.attachEvent("on"+t,o):e.addEventListener(t,o,!1)}function i(e,t,o){e.detachEvent?e.detachEvent&&e.detachEvent("on"+t,o):e.removeEventListener(t,o,!1)}function a(e,t){if(e&&t)for(var o=e.length,r=0;o>r&&!1!==t(e[r],r);r++);}function l(e,t){var o=0;return function(){var r=+new Date;t>r-o||(o=r,e.apply(m,arguments))}}var u,f,d,m,p,h,v,w,g;return e.prototype.revalidate=function(){t()},e.prototype.load=function(e,t){-1===(" "+e.className+" ").indexOf(" "+f.successClass+" ")&&r(e,t)},e.prototype.destroy=function(){f.container&&a(f.container,function(e){i(e,"scroll",w)}),i(window,"scroll",w),i(window,"resize",w),i(window,"resize",g),p=0,m.length=0,v=!0},e});
!function(e,t){if("object"==typeof exports&&exports)t(exports);else{var n={};t(n),"function"==typeof define&&define.amd?define(n):e.Mustache=n}}(this,function(e){function t(e,t){return f.call(e,t)}function n(e){return!t(g,e)}function r(e){return"function"==typeof e}function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function s(e){return String(e).replace(/[&<>"'\/]/g,function(e){return v[e]})}function o(e){if(!d(e)||2!==e.length)throw new Error("Invalid tags: "+e);return[new RegExp(i(e[0])+"\\s*"),new RegExp("\\s*"+i(e[1]))]}function a(t,r){function s(){if(w&&!d)for(;g.length;)delete f[g.pop()];else g=[];w=!1,d=!1}r=r||e.tags,t=t||"","string"==typeof r&&(r=r.split(y));for(var a=o(r),l=new h(t),p=[],f=[],g=[],w=!1,d=!1,v,m,E,T,j,C;!l.eos();){if(v=l.pos,E=l.scanUntil(a[0]))for(var A=0,R=E.length;R>A;++A)T=E.charAt(A),n(T)?g.push(f.length):d=!0,f.push(["text",T,v,v+1]),v+=1,"\n"===T&&s();if(!l.scan(a[0]))break;if(w=!0,m=l.scan(U)||"name",l.scan(k),"="===m?(E=l.scanUntil(b),l.scan(b),l.scanUntil(a[1])):"{"===m?(E=l.scanUntil(new RegExp("\\s*"+i("}"+r[1]))),l.scan(x),l.scanUntil(a[1]),m="&"):E=l.scanUntil(a[1]),!l.scan(a[1]))throw new Error("Unclosed tag at "+l.pos);if(j=[m,E,v,l.pos],f.push(j),"#"===m||"^"===m)p.push(j);else if("/"===m){if(C=p.pop(),!C)throw new Error('Unopened section "'+E+'" at '+v);if(C[1]!==E)throw new Error('Unclosed section "'+C[1]+'" at '+v)}else"name"===m||"{"===m||"&"===m?d=!0:"="===m&&(a=o(r=E.split(y)))}if(C=p.pop())throw new Error('Unclosed section "'+C[1]+'" at '+l.pos);return u(c(f))}function c(e){for(var t=[],n,r,i=0,s=e.length;s>i;++i)n=e[i],n&&("text"===n[0]&&r&&"text"===r[0]?(r[1]+=n[1],r[3]=n[3]):(t.push(n),r=n));return t}function u(e){for(var t=[],n=t,r=[],i,s,o=0,a=e.length;a>o;++o)switch(i=e[o],i[0]){case"#":case"^":n.push(i),r.push(i),n=i[4]=[];break;case"/":s=r.pop(),s[5]=i[2],n=r.length>0?r[r.length-1][4]:t;break;default:n.push(i)}return t}function h(e){this.string=e,this.tail=e,this.pos=0}function l(e,t){this.view=null==e?{}:e,this.cache={".":this.view},this.parent=t}function p(){this.cache={}}var f=RegExp.prototype.test,g=/\S/,w=Object.prototype.toString,d=Array.isArray||function(e){return"[object Array]"===w.call(e)},v={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},k=/\s*/,y=/\s+/,b=/\s*=/,x=/\s*\}/,U=/#|\^|\/|>|\{|&|=|!/;h.prototype.eos=function(){return""===this.tail},h.prototype.scan=function(e){var t=this.tail.match(e);if(t&&0===t.index){var n=t[0];return this.tail=this.tail.substring(n.length),this.pos+=n.length,n}return""},h.prototype.scanUntil=function(e){var t=this.tail.search(e),n;switch(t){case-1:n=this.tail,this.tail="";break;case 0:n="";break;default:n=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=n.length,n},l.prototype.push=function(e){return new l(e,this)},l.prototype.lookup=function(e){var t;if(e in this.cache)t=this.cache[e];else{for(var n=this;n;){if(e.indexOf(".")>0){t=n.view;for(var i=e.split("."),s=0;null!=t&&s<i.length;)t=t[i[s++]]}else t=n.view[e];if(null!=t)break;n=n.parent}this.cache[e]=t}return r(t)&&(t=t.call(this.view)),t},p.prototype.clearCache=function(){this.cache={}},p.prototype.parse=function(e,t){var n=this.cache,r=n[e];return null==r&&(r=n[e]=a(e,t)),r},p.prototype.render=function(e,t,n){var r=this.parse(e),i=t instanceof l?t:new l(t);return this.renderTokens(r,i,n,e)},p.prototype.renderTokens=function(t,n,i,s){function o(e){return c.render(e,n,i)}for(var a="",c=this,u,h,l=0,p=t.length;p>l;++l)switch(u=t[l],u[0]){case"#":if(h=n.lookup(u[1]),!h)continue;if(d(h))for(var f=0,g=h.length;g>f;++f)a+=this.renderTokens(u[4],n.push(h[f]),i,s);else if("object"==typeof h||"string"==typeof h)a+=this.renderTokens(u[4],n.push(h),i,s);else if(r(h)){if("string"!=typeof s)throw new Error("Cannot use higher-order sections without the original template");h=h.call(n.view,s.slice(u[3],u[5]),o),null!=h&&(a+=h)}else a+=this.renderTokens(u[4],n,i,s);break;case"^":h=n.lookup(u[1]),(!h||d(h)&&0===h.length)&&(a+=this.renderTokens(u[4],n,i,s));break;case">":if(!i)continue;h=r(i)?i(u[1]):i[u[1]],null!=h&&(a+=this.renderTokens(this.parse(h),n,i,h));break;case"&":h=n.lookup(u[1]),null!=h&&(a+=h);break;case"name":h=n.lookup(u[1]),null!=h&&(a+=e.escape(h));break;case"text":a+=u[1]}return a},e.name="mustache.js",e.version="0.8.1",e.tags=["{{","}}"];var m=new p;e.clearCache=function(){return m.clearCache()},e.parse=function(e,t){return m.parse(e,t)},e.render=function(e,t,n){return m.render(e,t,n)},e.to_html=function(t,n,i,s){var o=e.render(t,n,i);return r(s)?void s(o):o},e.escape=s,e.Scanner=h,e.Context=l,e.Writer=p});